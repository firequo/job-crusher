<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Other Job</title>
    <link rel="stylesheet" href="Jobs_Design.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap">
</head>

<body>
    <!--Navigation-->
    <div class="navbar">
        <div class="logo"><a href="/">The TOP</a></div>
        <b><a href="/">Home</a></b>
        <b><a href="/about">About</a></b>
        <b><a href="/jobs">Jobs</a></b>
        <b><a href="/contact">Contact</a></b>
    </div>
    <div id="formbox">
        <form>
            <input type="text" required minlength="4" id="job">
            <button onclick="addJob(); return false">
        </form>
    </div>
    <div id="jobChartBox">
    </div>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function addJob(){
        const job = document.getElementById('job').value
        console.log(job);
        if(labels.includes(job)) return;
        let loading = document.createElement('p');
        loading.textContent = 'Loading';
        loading.id = 'loading';
        document.getElementById('formbox').appendChild(loading);
        const json = await fetch(`/salary/${job}`).then((res) => res.json());
        loading.remove();
        console.log(json);
        const keys = Object.keys(json);
        if(keys.length != 1) return;
        console.log(labels);
        labels.push(keys[0]);
        data.push(json[keys[0]]);
        makeChart();
    }
    async function getTop(){
        const res = await fetch('/salary/top').then((res) => res.json());
        console.log(res);
        for(let i = 0; i < res.length; i++){
            labels.push(res[i].job);
            data.push(res[i].salary);
        }
        makeChart();
    }
    async function makeChart(){
        document.getElementById('jobChartBox').innerHTML = '';
        document.getElementById('jobChartBox').innerHTML = '<canvas id="jobChart"></canvas>';
        const ctx = document.getElementById('jobChart');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Mean Salary',
                    data: data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    let labels = [];
    let data = [];
    window.onload = getTop;
</script>
